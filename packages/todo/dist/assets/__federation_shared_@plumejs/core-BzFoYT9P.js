const F=t=>!!t&&typeof t.subscribe=="function",I=t=>!!t&&typeof t.then=="function",W=(()=>{try{return new CSSStyleSheet,!0}catch{return!1}})(),H=t=>({subscribe:s=>{s(t)}}),$=t=>({subscribe:s=>{Promise.resolve(t).then(e=>{s(e)})}}),A=()=>Math.random().toString(36).substring(2);class V{_callbackCollection={};unsubscribe(s){delete this._callbackCollection[s]}asObservable(){return{subscribe:s=>this.subscribe(s)}}subscribe(s){const e=A();return this._callbackCollection[e]=s,()=>this.unsubscribe(e)}next(s){for(const e in this._callbackCollection)this._callbackCollection[e](s)}}class rt extends V{_initialValue;constructor(s){super(),this._initialValue=s}subscribe(s){const e=super.subscribe(s);return super.next(this._initialValue),e}next(s){this._initialValue=s,super.next(s)}}class Q{_subcribers=[];add(s){this._subcribers.push(s)}unsubscribe(){for(const s of this._subcribers)s();this._subcribers=[]}}const it=t=>F(t)?t:I(t)?$(Promise.resolve(t)):H(t),C=(t,s,e,r=!1)=>(t.addEventListener(s,e,r),()=>{t.removeEventListener(s,e,r)}),z=t=>{const s=()=>new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),e=m=>{const b=m.querySelectorAll("script");for(const y of b)y.remove()},r=(m,b)=>{if(b=b.replace(/\s+/g,"").toLowerCase(),["src","href","xlink:href"].includes(m)&&(b.includes("javascript:")||b.includes("data:"))||m.startsWith("on"))return!0},a=m=>{const b=m.attributes;for(const{name:y,value:T}of b)r(y,T)&&m.removeAttribute(y)},p=m=>{const b=m.children;for(const y of b)a(y),p(y)},g=s();return e(g),p(g),g.innerHTML},J=(t,s)=>{const e=()=>({get(r,a){const p=Object.prototype.toString.call(r[a]);return["[object Object]","[object Array]"].indexOf(p)>-1&&!("__metadata__"in r[a])?new Proxy(r[a],e()):r[a]},set(r,a,p){return r[a]=p,t(),!0}});return class extends s{constructor(...r){return super(...r),new Proxy(this,e())}}},ot=()=>{let t;return[new Promise(e=>{t=e}),t]},U=t=>typeof t=="function",x=Object.create(null);let w=null;function q(t,s){const e=w;let r;w=A(),x[w]=t;try{s()}finally{r=w,w=e}return r}function ct(t){const s=x[w];let e=t;function r(){return e}return r.set=function(a){U(a)?e=a(e):e=a,s()},r}function B(t,s){const e=q(t,s);return function(){delete x[e]}}const O=new class{map=new WeakMap;register(t,s){if(!this.map.get(t))this.map.set(t,s);else throw Error(`${t} is already registered service.`)}getService(t){const s=this.map.get(t);if(s)return s;throw Error(`${t} is not a registered provider.`)}removeService(t){this.map.delete(t)}clear(){this.map=new WeakMap}},L=(t,s,e)=>{if(s.length){const r=[];for(const a of s)a.prototype.__metadata__.name!=="RENDERER"?r.push(O.getService(a)):r.push(e);return new t(...r)}else return new t},E=new class{globalStyles;style_registry;isRootNodeSet;globalStyleTag;constructor(){try{this.globalStyles=new CSSStyleSheet}catch{this.globalStyles=""}this.isRootNodeSet=!1,this.globalStyleTag=null}getComputedCss=(t="",s)=>{let e=[];const r=new CSSStyleSheet;if(r.insertRule(":host { display: block; }"),e=s?[r]:[this.globalStyles,r],t){const a=new CSSStyleSheet;a.replace(t),e.push(a)}return e}},{html:at,render:Y}=(()=>{const t=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,s=/<[a-z][^>]+$/i,e="attr",r=/^attr([^ ]+)/,a="insertNode",p=/^insertNode([^ ]+)/;let g=[],m=[];const b=o=>{const n={"&":"&amp;","<":"&lt;",">":"&gt;","(":"%28",")":"%29"};let l=JSON.stringify(o);const c=u=>n[u]||u;return l=(u=>u.replace(/[&<>\(\)]/g,c))(l),JSON.parse(l)},y=(o,n)=>{const l=o.options,c=Array.isArray(n)?n:[n];let f,u,i=l.length;for(;i--;){u=l[i];const d=u.getAttribute("value")??(u.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" ");(u.selected=c.indexOf(d)>-1)&&(f=!0)}f||(o.selectedIndex=-1)},T=o=>{const n=document.createElement("template");return n.innerHTML=o,n.content},N=(o,n,l)=>{const c=()=>{setTimeout(()=>{if(o.isConnected){const f=new CustomEvent("bindprops",{detail:{props:n},bubbles:!1});o.dispatchEvent(f)}})};o[l]=JSON.stringify(n),m.push(c)},M=(o,n)=>{const l=document.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,null);let c=l.nextNode();for(;c;){if(c.hasAttributes()){const f=Array.from(c.attributes).filter(u=>r.test(u.nodeName));for(const{nodeName:u,nodeValue:i}of f){const d=r.exec(u)[1];switch(!0){case/^on+/.test(i):{const h=i.slice(2).toLowerCase();c.removeEventListener(h,n[d]),c.addEventListener(h,n[d]);break}case/ref/.test(i):{const h=function(){this.node.isConnected&&this.fn(this.node)}.bind({node:c,fn:n[d]});g.push(h);break}case/^data-+/.test(i):case/^aria-+/.test(i):{i==="data-input"?N(c,n[d],Symbol("input")):c.setAttribute(i,b(n[d]));break}case/class/.test(i):{n[d]?c.classList.add(...n[d].split(" ")):c.setAttribute("class","");break}case/value/.test(i):{c.nodeName.toLowerCase()==="select"?y(c,n[d]):c.value=b(n[d]);break}case/disabled/.test(i):case/checked/.test(i):{n[d]?c.setAttribute(i,n[d]):c.removeAttribute(i);break}default:c.setAttribute(i,b(n[d]))}c.removeAttribute(u)}}c=l.nextNode()}},D=(o,n)=>{const l=document.createTreeWalker(o,NodeFilter.SHOW_COMMENT,null);let c=l.nextNode(),f;for(;c;){if(f=p.exec(c.data)){const u=Array.isArray(n[f[1]])?n[f[1]]:[n[f[1]]];c.replaceWith(...u),l.currentNode=o}c=l.nextNode()}},j=(o,n)=>{if(!o||!n||o.nodeType!==1||n.nodeType!==1)return;const l=o.attributes,c=n.attributes,f=n.getAttribute("data-preserve-attributes"),u=f&&f==="true";for(const{name:i,value:d}of l)(!c[i]||c[i]!==d)&&n.setAttribute(i,d);if(!u)for(const{name:i}of c)l[i]||n.removeAttribute(i);if(n.tagName.toLowerCase()==="input"&&(n.value=o.value),n.tagName.indexOf("-")>-1&&o.tagName.indexOf("-")>-1){const i=Object.getOwnPropertySymbols(o).find(S=>S.description==="input"),d=Object.getOwnPropertySymbols(n).find(S=>S.description==="input"),h=i?o[i]:"",_=d?n[d]:"";h&&_&&h!==_&&N(n,JSON.parse(h),d)}},R=o=>o.nodeType===3?"text":o.nodeType===8?"comment":o.tagName.toLowerCase(),v=o=>o.childNodes&&o.childNodes.length>0?null:o.textContent,k=(o,n,l)=>{const c=n?Array.from(n.childNodes):[],f=o?Array.from(o.childNodes):[];let u=c.length-f.length;if(u>0)for(;u>0;u--)c[c.length-u].parentNode.removeChild(c[c.length-u]);f.forEach((i,d)=>{const h=c[d];if(j(i,h),l&&h&&h.nodeType===1&&h.tagName.indexOf("-")>-1)return;if(!h){n&&n.appendChild(i);return}if(R(i)!==R(h)){h.replaceWith(i);return}const _=v(i);if(_&&_!==v(h)){h.textContent=_;return}if(h.childNodes.length>0&&i.childNodes.length<1){h.innerHTML="";return}if(h.childNodes.length<1&&i.childNodes.length>0){const S=document.createDocumentFragment();k(i,S,!1),h.appendChild(S);return}if(i.childNodes.length>0){k(i,h,!0);return}})};return{html:(o,...n)=>{let l="";const{length:c}=o;for(let u=1;u<c;u++){const i=n[u-1];let d=!1;if(l+=o[u-1],t.test(l)&&s.test(l)&&(l=l.replace(t,(h,_,S)=>`${e}${u-1}=${S||'"'}${_}${S?"":'"'}`),d=!0),!d)switch(!0){case Array.isArray(i):case i instanceof DocumentFragment:{l+=`<!--${a}${u-1}-->`;break}case(typeof i=="object"&&i!==null):{"html"in i&&(l+=i.html);break}default:l+=i||""}}l+=o[c-1];const f=T(l.trim());return M(f,n),D(f,n),f},render:(o,n)=>{o&&!o.children.length?(o.innerHTML="",o.appendChild(n)):k(n,o,!1),g.forEach(l=>{l()}),g=[],m.forEach(l=>{l()}),m=[]}}})();class G{_hostElement;_shadowRoot;get __metadata__(){return{name:"RENDERER"}}get hostElement(){return this._hostElement}get shadowRoot(){return this._shadowRoot}update;emitEvent;constructor(s,e){this._hostElement=s,this._shadowRoot=e}}const K={selector:"",root:!1,styles:"",deps:[],standalone:!1,shadowDomEncapsulation:!0},P=(t,s=null)=>{const e=document.createElement("style");return e.innerHTML=t,s&&s.appendChild(e),e},X=async(t,s)=>{if(t={...K,...t},I(t.styles)){const e=await t.styles;t.styles=e.default.toString()}if(t.styles=t.styles.toString(),t.root&&!E.isRootNodeSet)E.isRootNodeSet=!0,t.styles&&(E.globalStyleTag=P(t.styles,document.head),E.globalStyles.replace(t.styles));else if(t.root&&E.isRootNodeSet)throw Error("Cannot register duplicate root component in "+t.selector+" component");window.customElements.define(t.selector,class extends HTMLElement{klass;shadow;componentStyleTag=null;internalSubscriptions=new Q;renderCount=0;static get observedAttributes(){return s.observedAttributes||[]}constructor(){if(super(),t.shadowDomEncapsulation&&W)this.shadow=this.attachShadow({mode:"open"}),this.shadow.adoptedStyleSheets=E.getComputedCss(t.styles,t.standalone);else{this.shadow=this;const e=A();this.setAttribute("data-did",e);const r=t.styles.replaceAll(":host",`${t.selector}[data-did='${e}']`);this.componentStyleTag=P(r,document.head)}this.getInstance=this.getInstance.bind(this),this.update=this.update.bind(this),this.setRenderIntoQueue=this.setRenderIntoQueue.bind(this),this.createProxyInstance()}createProxyInstance(){const e=new G(this,this.shadow);e.update=()=>{this.update()},e.emitEvent=(r,a)=>{this.emitEvent(r,a)},this.klass=L(J(this.setRenderIntoQueue,s),t.deps,e)}update(){const e=this.klass.render();typeof e=="string"?this.shadow.innerHTML=z(e):Y(this.shadow,e)}emitEvent(e,r){const a=new CustomEvent(e,{detail:r});this.dispatchEvent(a)}setProps(e){for(const[r,a]of Object.entries(e))s.observedProperties.find(p=>p===r)&&(this.klass[r]=a);this.klass.onPropertiesChanged?.()}getInstance(){return this.klass}setRenderIntoQueue(){++this.renderCount,this.renderCount===1&&queueMicrotask(()=>{this.update(),this.renderCount=0})}connectedCallback(){this.internalSubscriptions.add(C(this,"bindprops",e=>{const r=e.detail.props;r&&this.setProps(r)})),this.internalSubscriptions.add(C(this,"refresh_component",()=>{this.update()})),this.internalSubscriptions.add(C(window,"onLanguageChange",()=>{this.update()})),this.klass.beforeMount&&this.internalSubscriptions.add(B(this.setRenderIntoQueue,this.klass.beforeMount.bind(this.klass))),this.update(),this.klass.mount?.()}attributeChangedCallback(e,r,a){this.klass.onAttributesChanged?.(e,r,a)}disconnectedCallback(){this.renderCount=0,this.klass.unmount?.(),this.componentStyleTag?.remove(),this.internalSubscriptions.unsubscribe()}})},Z={deps:[]},lt=t=>s=>{if(t.selector.indexOf("-")<=0)throw new Error("You need at least 1 dash in the custom element name!");window.customElements.get(t.selector)||(Object.defineProperty(s.prototype,"selector",{get(){return t.selector}}),X(t,s))},tt=(t={})=>s=>{if(t={...Z,...t},s.prototype.__metadata__={name:"SERVICE"},t.deps.some(r=>r.prototype.__metadata__?.name==="RENDERER"))throw Error("Renderer cannot be a dependency for a service. It should be used with component");const e=L(s,t.deps);O.register(s,e)},ut=(t,s)=>{const e=typeof t=="string"?{name:t}:t;return O.register(e,s),e};class et{transition="";constructor(){this.whichTransitionEnd()}onTransitionEnd(s,e,r){let a=!1,p=null;const g=()=>{a||(a=!0,e&&e(),p(),p=null)};p=C(s,this.transition,()=>{g()}),setTimeout(g,r)}animationsComplete(s){return s.getAnimations?Promise.allSettled(s.getAnimations().map(e=>e.finished)):Promise.allSettled([!0])}whichTransitionEnd(){const e=document.createElement("div").style,r={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend"};for(const a in r)if(typeof e[a]<"u"){this.transition=r[a];break}}}tt()(et);export{rt as BehaviourSubjectObs,lt as Component,et as DomTransition,tt as Injectable,ut as InjectionToken,O as Injector,G as Renderer,V as SubjectObs,Q as Subscriptions,C as fromEvent,at as html,ot as promisify,Y as render,ct as signal,it as wrapIntoObservable};
